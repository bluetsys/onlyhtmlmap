<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>구글 타일 지도</title>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css" />
    <style>
        html,
        body {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .help-key {
            display: inline-block;
            background: #222;
            color: #fff;
            border-radius: 6px;
            padding: 2px 7px;
            margin: 1px 2px;
            font-size: 0.95em;
            font-family: inherit;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.10);
            vertical-align: middle;
        }

        #map {
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: #eee;
            overflow: hidden;
        }

        .center-tile {
            border: 2px solid #007bff !important;
            box-sizing: border-box;
        }

        #info-bar {
            position: fixed;
            left: 50%;
            bottom: 20px;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            color: #222;
            font-size: 1.05rem;
            padding: 8px 18px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            z-index: 102;
            pointer-events: none;
            white-space: nowrap;
        }

        .help {
            position: fixed;
            left: 20px;
            bottom: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            padding: 8px 12px;
            z-index: 7;
            font-size: 13px;
        }

        .quick-move {
            position: absolute;
            top: 40px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            padding: 8px 12px;
            z-index: 8;
            font-size: 14px;
        }

        .quick-move button {
            margin: 2px 4px;
        }
    </style>
</head>

<body>
    <div class="quick-move">
        <button onclick="moveTo(37.5665,126.9780,15)">서울시청</button>
        <button onclick="moveTo(35.1796,129.0756,15)">부산시청</button>
        <button onclick="moveTo(36.906984,127.532255,17)">기본 위치</button>
        <button onclick="moveTo(33.4996,126.5312,15)">제주시청</button>
    </div>
    <div class="help">
        <b>조작 방법</b><br>
        <span class="help-key">+</span> <span class="help-key">-</span> 줌 조절 <span class="help-key">0</span> 기본줌<br>
        <span class="help-key">마우스 휠</span> 줌 조절<br>
        <span class="help-key">타일 드레그</span> 해당 위치로 중심 이동<br>
        <span class="help-key">1</span>~<span class="help-key">7</span> 지도 타입 변경<br>
        <span class="help-key">9</span> 지도 변경 (구글/브이월드)<br>
    </div>
    <a class="github-fork-ribbon right-top" href="https://github.com/bluetsys/onlyhtmlmap"
        data-ribbon="Fork me on GitHub" title="Fork me on GitHub" target="_blank">Fork me on GitHub</a>
    <div id="map"></div>
    <div id="info-bar"></div>
    <script>
        const mapDiv = document.getElementById('map');
        const mapTypeGoogle = [
            { key: 1, name: 'standard roadmap', url: 'https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}' },
            { key: 2, name: 'roads only', url: 'https://mt1.google.com/vt/lyrs=h&x={x}&y={y}&z={z}' },
            { key: 3, name: 'terrain', url: 'https://mt1.google.com/vt/lyrs=p&x={x}&y={y}&z={z}' },
            { key: 4, name: 'somehow altered roadmap', url: 'https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}' },
            { key: 5, name: 'satellite only', url: 'https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}' },
            { key: 6, name: 'terrain only', url: 'https://mt1.google.com/vt/lyrs=t&x={x}&y={y}&z={z}' },
            { key: 7, name: 'hybrid', url: 'https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}' },
        ];
        const mapTypeVworld = [
            { key: 1, name: 'Base', url: 'http://xdworld.vworld.kr:8080/2d/Base/201710/{z}/{x}/{y}.png' },
            { key: 2, name: 'midnight', url: 'http://xdworld.vworld.kr:8080/2d/midnight/201710/{z}/{x}/{y}.png' },
            { key: 3, name: 'Hybrid', url: 'http://xdworld.vworld.kr:8080/2d/Hybrid/201710/{z}/{x}/{y}.png' },
            { key: 4, name: 'Satellite', url: 'http://xdworld.vworld.kr:8080/2d/Satellite/201710/{z}/{x}/{y}.jpeg' }
        ];
        const mapTypeKakao = [
            { key: 1, name: 'Base', url: 'http://xdworld.vworld.kr:8080/2d/Base/201710/{z}/{x}/{y}.png' },
            { key: 2, name: 'midnight', url: 'https://map.pstatic.net/nrb/styles/basic/1676618181/{z}/{x}/{y}@2x.png?mt=bg.ol.sw' },
            { key: 3, name: 'Hybrid', url: 'http://xdworld.vworld.kr:8080/2d/Hybrid/201710/{z}/{x}/{y}.png' },
            { key: 4, name: 'Satellite', url: 'http://xdworld.vworld.kr:8080/2d/Satellite/201710/{z}/{x}/{y}.jpeg' }
        ];
        let mapTypes = mapTypeVworld;
        let mapTypeIdx = 2; // 기본 standard roadmap
        const tileSize = 256;
        let zoom = 12;
        const center = { lat: 37.5665, lng: 126.9780 };

        function latLngToTile(lat, lng, zoom) {
            const n = Math.pow(2, zoom);
            const x = Math.floor((lng + 180) / 360 * n);
            const latRad = lat * Math.PI / 180;
            const y = Math.floor((1 - Math.log(Math.tan(latRad) + 1 / Math.cos(latRad)) / Math.PI) / 2 * n);
            return { x, y };
        }

        // tile 좌표를 위도/경도로 변환
        function tileToLatLng(x, y, zoom) {
            const n = Math.pow(2, zoom);
            const lng = x / n * 360 - 180;
            const latRad = Math.atan(Math.sinh(Math.PI * (1 - 2 * y / n)));
            const lat = latRad * 180 / Math.PI;
            return { lat, lng };
        }

        function latLngToPixel(lat, lng, zoom) {
            const n = Math.pow(2, zoom) * tileSize;
            const x = ((lng + 180) / 360) * n;
            const latRad = lat * Math.PI / 180;
            const y = (1 - Math.log(Math.tan(latRad) + 1 / Math.cos(latRad)) / Math.PI) / 2 * n;
            return { x, y };
        }
        function pixelToLatLng(px, py, zoom) {
            const n = Math.pow(2, zoom) * tileSize;
            const lng = px / n * 360 - 180;
            const latRad = Math.atan(Math.sinh(Math.PI * (1 - 2 * py / n)));
            const lat = latRad * 180 / Math.PI;
            return { lat, lng };
        }
        function drawTiles() {
            mapDiv.innerHTML = '';
            const width = mapDiv.clientWidth;
            const height = mapDiv.clientHeight;

            // 중심 타일 좌표 계산 (픽셀 기준 렌더링과 infoBar/하이라이트용)
            const centerPx = latLngToPixel(center.lat, center.lng, zoom);
            const centerTile = latLngToTile(center.lat, center.lng, zoom);
            const tilesX = Math.ceil(width / tileSize) + 2;
            const tilesY = Math.ceil(height / tileSize) + 2;
            const screenLeftPx = centerPx.x - width / 2;
            const screenTopPx = centerPx.y - height / 2;
            const startTileX = Math.floor(screenLeftPx / tileSize);
            const startTileY = Math.floor(screenTopPx / tileSize);
            const startTileLeftPx = startTileX * tileSize;
            const startTileTopPx = startTileY * tileSize;
            for (let dy = 0; dy < tilesY; dy++) {
                for (let dx = 0; dx < tilesX; dx++) {
                    const x = startTileX + dx;
                    const y = startTileY + dy;
                    // 타일의 화면상 위치 (픽셀 단위 오프셋)
                    const left = (x * tileSize - screenLeftPx);
                    const top = (y * tileSize - screenTopPx);
                    const img = document.createElement('img');
                    const tileUrl = mapTypes[mapTypeIdx - 1].url
                        .replace('{x}', x)
                        .replace('{y}', y)
                        .replace('{z}', zoom);
                    img.src = tileUrl;
                    img.style.position = 'absolute';
                    img.style.left = left + 'px';
                    img.style.top = top + 'px';
                    img.style.width = tileSize + 'px';
                    img.style.height = tileSize + 'px';
                    img.style.zIndex = 1;
                    img.style.borderRight = '1px solid #bbb';
                    img.style.borderBottom = '1px solid #bbb';
                    img.style.boxSizing = 'border-box';
                    img.draggable = false;
                    // 중심 타일 하이라이트 (타일 좌표 기준)
                    if (x === centerTile.x && y === centerTile.y) {
                        img.classList.add('center-tile');
                    }
                    mapDiv.appendChild(img);
                }
            }

            // 지도 패닝(드래그 이동) 픽셀 단위 구현
            if (!window._mapDragState) {
                window._mapDragState = {
                    isDragging: false,
                    dragStartX: 0,
                    dragStartY: 0,
                    dragOriginPx: null,
                };
            }
            if (!mapDiv._dragEventsAdded) {
                mapDiv._dragEventsAdded = true;
                // 마우스 드래그
                mapDiv.addEventListener('mousedown', function (e) {
                    window._mapDragState.isDragging = true;
                    window._mapDragState.dragStartX = e.clientX;
                    window._mapDragState.dragStartY = e.clientY;
                    window._mapDragState.dragOriginPx = latLngToPixel(center.lat, center.lng, zoom);
                    mapDiv.style.cursor = 'grabbing';
                });
                let dragFrame = null;
                let dragMove = null;
                window.addEventListener('mousemove', function (e) {
                    if (!window._mapDragState.isDragging) return;
                    dragMove = { x: e.clientX, y: e.clientY };
                    if (!dragFrame) {
                        dragFrame = requestAnimationFrame(() => {
                            if (window._mapDragState.isDragging && dragMove) {
                                const dx = dragMove.x - window._mapDragState.dragStartX;
                                const dy = dragMove.y - window._mapDragState.dragStartY;
                                const newPx = window._mapDragState.dragOriginPx.x - dx;
                                const newPy = window._mapDragState.dragOriginPx.y - dy;
                                const newCenter = pixelToLatLng(newPx, newPy, zoom);
                                center.lat = newCenter.lat;
                                center.lng = newCenter.lng;
                                drawTiles();
                            }
                            dragFrame = null;
                        });
                    }
                });
                window.addEventListener('mouseup', function (e) {
                    if (window._mapDragState.isDragging) {
                        window._mapDragState.isDragging = false;
                        mapDiv.style.cursor = 'grab';
                    }
                });
                mapDiv.style.cursor = 'grab';

                // 터치 드래그(모바일)
                mapDiv.addEventListener('touchstart', function (e) {
                    if (e.touches.length !== 1) return;
                    const touch = e.touches[0];
                    window._mapDragState.isDragging = true;
                    window._mapDragState.dragStartX = touch.clientX;
                    window._mapDragState.dragStartY = touch.clientY;
                    window._mapDragState.dragOriginPx = latLngToPixel(center.lat, center.lng, zoom);
                }, { passive: false });
                mapDiv.addEventListener('touchmove', function (e) {
                    if (!window._mapDragState.isDragging || e.touches.length !== 1) return;
                    e.preventDefault();
                    const touch = e.touches[0];
                    const dx = touch.clientX - window._mapDragState.dragStartX;
                    const dy = touch.clientY - window._mapDragState.dragStartY;
                    const newPx = window._mapDragState.dragOriginPx.x - dx;
                    const newPy = window._mapDragState.dragOriginPx.y - dy;
                    const newCenter = pixelToLatLng(newPx, newPy, zoom);
                    center.lat = newCenter.lat;
                    center.lng = newCenter.lng;
                    drawTiles();
                }, { passive: false });
                mapDiv.addEventListener('touchend', function (e) {
                    window._mapDragState.isDragging = false;
                });
            }

            const infoBar = document.getElementById('info-bar');
            infoBar.innerHTML = `<b>중심 좌표:</b> ${center.lat.toFixed(6)}, ${center.lng.toFixed(6)} &#124; <b>줌:</b> ${zoom} &#124; <b>타입:</b> ${mapTypes[mapTypeIdx - 1].name} &#124; <b>타일:</b> x=${centerTile.x}, y=${centerTile.y}`;
        }

        window.addEventListener('keydown', function (e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

            switch (e.key) {
                case '+':
                    if (zoom < 19) {
                        zoom++;
                        reloadTiles();
                    }
                    break;
                case '-':
                    if (zoom > 1) {
                        zoom--;
                        reloadTiles();
                    }
                    break;
                case '0':
                    zoom = 12;
                    reloadTiles();
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                case '5':
                case '6':
                case '7':
                    idx = parseInt(e.key);
                    if (mapTypes.length < idx) {
                        break;
                    }
                    mapTypeIdx = idx;
                    reloadTiles();
                    break;
                case '9':
                    console.log(mapTypes.length);
                    if (mapTypes.length === 4) {
                        console.log('Google Map 타입으로 변경');
                        mapTypes = mapTypeGoogle;

                        mapTypeIdx = 1;
                    }
                    else {
                        console.log('Vworld Map 타입으로 변경');
                        mapTypes = mapTypeVworld;
                        mapTypeIdx = 1;
                    }
                    reloadTiles();
                    break;
            }
        });

        function moveTo(lat, lng, zoomLevel) {
            center.lat = lat;
            center.lng = lng;
            if (zoomLevel) {
                zoom = zoomLevel;
            }
            reloadTiles();
        }

        function reloadTiles() {
            drawTiles();
        }

        function wheelEvent() {
            mapDiv.addEventListener('wheel', function (e) {
                e.preventDefault();
                if (e.deltaY < 0 && zoom < 19) {
                    zoom++;
                    drawTiles();
                } else if (e.deltaY > 0 && zoom > 1) {
                    zoom--;
                    drawTiles();
                }
            }, { passive: false });
        }

        window.addEventListener('resize', drawTiles);
        window.addEventListener('DOMContentLoaded', drawTiles);
        window.addEventListener('DOMContentLoaded', wheelEvent);
    </script>
    <script type="text/javascript">
        var sc_project = 13139524;
        var sc_invisible = 1;
        var sc_security = "83232f9f"; 
    </script>
    <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
    <noscript>
        <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
                    class="statcounter" src="https://c.statcounter.com/13139524/0/83232f9f/1/" alt="Web Analytics"
                    referrerPolicy="no-referrer-when-downgrade"></a></div>
    </noscript>
    <!-- End of Statcounter Code -->
    <script type="text/javascript" src="//wcs.naver.net/wcslog.js"></script>
    <script type="text/javascript">
        if (!wcs_add) var wcs_add = {};
        wcs_add["wa"] = "14cd277c95fd60";
        if (window.wcs) {
            wcs_do();
        }
    </script>
</body>

</html>
